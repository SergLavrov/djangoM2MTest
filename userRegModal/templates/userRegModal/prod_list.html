{#{% extends 'userRegModal/home3.html' %}#}
{##}
{#{% block content %}#}
{##}
{#  <div class="container" style="margin-top: 80px;">#}
{#    <h1>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h1>#}
{#    <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤.</p>#}
{#  </div>#}
{##}
{#{% endblock %}#}

üîπ mysite/urls.py

from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path("admin/", admin.site.urls),
    path("", include("accounts.urls")),  # –ø–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
]


üîπ accounts/urls.py

from django.urls import path
from .views import home_view, register_view

urlpatterns = [
    path("", home_view, name="home"),
    path("register/", register_view, name="register"),
]


üîπ accounts/views.py

from django.http import JsonResponse
from django.shortcuts import render
from django.contrib.auth.models import User
from django.views.decorators.csrf import csrf_exempt

def home_view(request):
    return render(request, "base.html")

@csrf_exempt  # –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è, –Ω–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CSRF —Ç–æ–∫–µ–Ω
def register_view(request):
    if request.method == "POST":
        username = request.POST.get("username")
        password = request.POST.get("password")

        if not username or not password:
            return JsonResponse({"success": False, "error": "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è"})

        if User.objects.filter(username=username).exists():
            return JsonResponse({"success": False, "error": "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–Ω—è—Ç–æ"})

        User.objects.create_user(username=username, password=password)
        return JsonResponse({"success": True})

    return JsonResponse({"success": False, "error": "–ù–µ–≤–µ—Ä–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞"})



üîπ accounts/templates/base.html

{% load static %}
{#<!DOCTYPE html>#}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ–π–°–∞–π—Ç</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- üîπ Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home' %}">–ú–æ–π–°–∞–π—Ç</a>
    <button class="btn btn-outline-primary ms-auto"
            data-bs-toggle="modal"
            data-bs-target="#registerModal">
      –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    </button>
  </div>
</nav>

<!-- üîπ –ö–æ–Ω—Ç–µ–Ω—Ç -->
<div class="container mt-4">
    <h1>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h1>
</div>

<!-- üîπ –ú–æ–¥–∞–ª -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form id="registerForm" method="post">
          {% csrf_token %}
          <div class="mb-3">
            <label for="username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <input type="text" class="form-control" id="username" name="username">
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" class="form-control" id="password" name="password">
          </div>
          <button type="submit" class="btn btn-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </form>
        <div id="errorBox" class="text-danger mt-2"></div>
      </div>

    </div>
  </div>
</div>

<!-- üîπ Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- üîπ JS –ª–æ–≥–∏–∫–∞ -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById("registerForm");
  const errorBox = document.getElementById("errorBox");

  form.addEventListener("submit", function(e) {
    e.preventDefault();

    const formData = new FormData(form);

    fetch("{% url 'register' %}", {
      method: "POST",
      body: formData,
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        errorBox.textContent = "";
        const modal = bootstrap.Modal.getInstance(document.getElementById("registerModal"));
        modal.hide();
        alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!");
      } else {
        errorBox.textContent = data.error;
      }
    })
    .catch(error => {
      errorBox.textContent = "–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º";
      console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error);
    });
  });
});
</script>

</body>
</html>





–î–æ–ø–æ–ª–Ω–∏–º –Ω–∞—à –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ç–∞–∫, —á—Ç–æ–±—ã —É —Ç–µ–±—è –±—ã–ª –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª:
—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª).

üîπ –û–±–Ω–æ–≤–∏–º accounts/urls.py

from django.urls import path
from .views import home_view, register_view, login_view, logout_view

urlpatterns = [
    path("", home_view, name="home"),
    path("register/", register_view, name="register"),
    path("login/", login_view, name="login"),
    path("logout/", logout_view, name="logout"),
]


üîπ –û–±–Ω–æ–≤–∏–º accounts/views.py

from django.http import JsonResponse
from django.shortcuts import render
from django.contrib.auth.models import User
from django.contrib.auth import authenticate, login, logout
from django.views.decorators.csrf import csrf_exempt

def home_view(request):
    return render(request, "base.html")

@csrf_exempt
def register_view(request):
    if request.method == "POST":
        username = request.POST.get("username")
        password = request.POST.get("password")

        if not username or not password:
            return JsonResponse({"success": False, "error": "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è"})

        if User.objects.filter(username=username).exists():
            return JsonResponse({"success": False, "error": "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–Ω—è—Ç–æ"})

        User.objects.create_user(username=username, password=password)
        return JsonResponse({"success": True})

    return JsonResponse({"success": False, "error": "–ù–µ–≤–µ—Ä–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞"})

@csrf_exempt
def login_view(request):
    if request.method == "POST":
        username = request.POST.get("username")
        password = request.POST.get("password")

        user = authenticate(request, username=username, password=password)
        if user is not None:
            login(request, user)
            return JsonResponse({"success": True})
        else:
            return JsonResponse({"success": False, "error": "–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞"})

    return JsonResponse({"success": False, "error": "–ù–µ–≤–µ—Ä–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞"})


def logout_view(request):
    logout(request)
    return JsonResponse({"success": True})



üîπ –û–±–Ω–æ–≤–∏–º accounts/templates/base.html
–î–æ–±–∞–≤–∏–º –≤—Ç–æ—Ä–æ–π –º–æ–¥–∞–ª –¥–ª—è –≤—Ö–æ–¥–∞:

<!-- üîπ Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home' %}">–ú–æ–π–°–∞–π—Ç</a>

    {% if user.is_authenticated %}
      <span class="me-3">–ü—Ä–∏–≤–µ—Ç, {{ user.username }}!</span>
      <button class="btn btn-outline-danger" id="logoutBtn">–í—ã—Ö–æ–¥</button>
    {% else %}
      <button class="btn btn-outline-primary ms-auto me-2"
              data-bs-toggle="modal"
              data-bs-target="#registerModal">
        –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
      </button>
      <button class="btn btn-outline-success"
              data-bs-toggle="modal"
              data-bs-target="#loginModal">
        –í—Ö–æ–¥
      </button>
    {% endif %}
  </div>
</nav>

<!-- üîπ –ú–æ–¥–∞–ª —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="registerForm" method="post">
          {% csrf_token %}
          <div class="mb-3">
            <label for="username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <input type="text" class="form-control" id="username" name="username">
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" class="form-control" id="password" name="password">
          </div>
          <button type="submit" class="btn btn-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </form>
        <div id="registerError" class="text-danger mt-2"></div>
      </div>
    </div>
  </div>
</div>

<!-- üîπ –ú–æ–¥–∞–ª –≤—Ö–æ–¥–∞ -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–í—Ö–æ–¥</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="loginForm" method="post">
          {% csrf_token %}
          <div class="mb-3">
            <label for="loginUsername" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <input type="text" class="form-control" id="loginUsername" name="username">
          </div>
          <div class="mb-3">
            <label for="loginPassword" class="form-label">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" class="form-control" id="loginPassword" name="password">
          </div>
          <button type="submit" class="btn btn-success">–í–æ–π—Ç–∏</button>
        </form>
        <div id="loginError" class="text-danger mt-2"></div>
      </div>
    </div>
  </div>
</div>

<!-- üîπ JS –ª–æ–≥–∏–∫–∞ -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  const registerForm = document.getElementById("registerForm");
  const registerError = document.getElementById("registerError");
  registerForm.addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(registerForm);
    fetch("{% url 'register' %}", { method: "POST", body: formData })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          registerError.textContent = "";
          bootstrap.Modal.getInstance(document.getElementById("registerModal")).hide();
          location.reload();
        } else {
          registerError.textContent = data.error;
        }
      });
  });

  // –í—Ö–æ–¥
  const loginForm = document.getElementById("loginForm");
  const loginError = document.getElementById("loginError");
  loginForm.addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(loginForm);
    fetch("{% url 'login' %}", { method: "POST", body: formData })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          loginError.textContent = "";
          bootstrap.Modal.getInstance(document.getElementById("loginModal")).hide();
          location.reload();
        } else {
          loginError.textContent = data.error;
        }
      });
  });

  // –í—ã—Ö–æ–¥
  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", function() {
      fetch("{% url 'logout' %}")
        .then(res => res.json())
        .then(data => {
          if (data.success) location.reload();
        });
    });
  }
});
</script>


üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –≤ navbar –¥–≤–µ –∫–Ω–æ–ø–∫–∏: ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª –∏ ¬´–í—Ö–æ–¥¬ª.

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–Ω–æ–ø–∫–∞ ¬´–í—ã—Ö–æ–¥¬ª.

–í—Å–µ —Ñ–æ—Ä–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ AJAX, –æ–±–Ω–æ–≤–ª—è—é—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.